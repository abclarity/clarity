<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clarity - Funnel Tracking</title>
  <link rel="stylesheet" href="style.css" />

  <!-- üî• Papa Parse (CSV-Parser) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>

<body>
  <!-- Header -->
  <header id="app-header"></header>

  <!-- Kontextmen√º f√ºr Monate -->
  <div id="contextMenu" class="context-menu">
    <button id="resetMonthBtn">Monat zur√ºcksetzen</button>
    <button id="deleteMonthBtn">Monat l√∂schen</button>
  </div>

  <!-- üî• NEU: Kontextmen√º f√ºr Funnels -->
  <div id="funnelContextMenu" class="context-menu">
    <button id="renameFunnelBtn">Umbenennen</button>
    <button id="changeColorBtn">Farbe √§ndern</button>
    <button id="deleteFunnelBtn">Funnel l√∂schen</button>
  </div>

  <!-- Hauptbereich -->

  <!-- Hauptbereich -->
  <main id="app"></main>

  <!-- Tabs (unten) -->
  <footer id="tabs" class="tabbar"></footer>

  <!-- Modal: Neuer Monat -->
  <div id="monthModal" class="modal hidden">
    <div class="modal-content">
      <h2>Neuen Monat hinzuf√ºgen</h2>
      <form id="monthForm">
        <label>
          <input type="radio" name="mode" value="next" checked />
          N√§chster Monat: <span id="suggestedMonth">Dezember 2025</span>
        </label>
        <br />
        <label>
          <input type="radio" name="mode" value="custom" />
          Anderen Monat w√§hlen:
        </label>
        <div class="custom-fields hidden">
          <label>Jahr:
            <input type="number" id="yearInput" value="2025" min="2000" max="2100" />
          </label>
          <label>Monat:
            <select id="monthInput">
              <option value="0">Januar</option>
              <option value="1">Februar</option>
              <option value="2">M√§rz</option>
              <option value="3">April</option>
              <option value="4">Mai</option>
              <option value="5">Juni</option>
              <option value="6">Juli</option>
              <option value="7">August</option>
              <option value="8">September</option>
              <option value="9">Oktober</option>
              <option value="10">November</option>
              <option value="11">Dezember</option>
            </select>
          </label>
        </div>
        <div class="buttons">
          <button type="button" id="cancelModal">Abbrechen</button>
          <button type="submit" id="createMonth">Erstellen</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Neuer Funnel -->
  <div id="funnelModal" class="modal hidden">
    <div class="modal-content wizard-modal">

      <!-- Toggle: Wizard / Presets -->
      <div class="wizard-toggle">
        <button id="wizardModeBtn" class="toggle-btn active">üßô Funnel-Wizard</button>
        <button id="presetModeBtn" class="toggle-btn">‚ö° Schnell-Auswahl</button>
      </div>

      <!-- WIZARD MODE -->
      <div id="wizardMode" class="wizard-container">

        <!-- Progress Dots -->
        <div class="wizard-progress" id="wizardProgress">
          <span class="dot active"></span>
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>

        <!-- Step 1: Traffic -->
        <div class="wizard-step active" data-step="1">
          <h2>Woher kommt dein Traffic?</h2>
          <div class="wizard-options">
            <label class="wizard-option">
              <input type="radio" name="traffic" value="paid-ads" />
              <div class="option-card">
                <div class="option-icon">üì¢</div>
                <div class="option-title">Paid Ads</div>
                <div class="option-desc">Facebook, Google, TikTok... </div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="traffic" value="organic" />
              <div class="option-card">
                <div class="option-icon">üå±</div>
                <div class="option-title">Organic</div>
                <div class="option-desc">SEO, Social Media, YouTube...</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="traffic" value="cold-email" />
              <div class="option-card">
                <div class="option-icon">üìß</div>
                <div class="option-title">Cold Email</div>
                <div class="option-desc">Outbound Email Campaigns</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="traffic" value="cold-calls" />
              <div class="option-card">
                <div class="option-icon">üìû</div>
                <div class="option-title">Cold Calls</div>
                <div class="option-desc">Outbound Phone Calls</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Step 1B: Cold Calls Special -->
        <div class="wizard-step" data-step="1b">
          <h2>Buchst du direkt ein Gespr√§ch oder schickst du den Prospect auf eine Landingpage? </h2>
          <div class="wizard-options">
            <label class="wizard-option">
              <input type="radio" name="coldcalls-flow" value="direct" />
              <div class="option-card">
                <div class="option-icon">üìû</div>
                <div class="option-title">Gespr√§ch direkt buchen</div>
                <div class="option-desc">Im Call wird direkt ein Termin vereinbart</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="coldcalls-flow" value="landingpage" />
              <div class="option-card">
                <div class="option-icon">üåê</div>
                <div class="option-title">Auf Landingpage schicken</div>
                <div class="option-desc">Prospect macht alleine weiter</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Step 2: VSL?   -->
        <div class="wizard-step" data-step="2">
          <h2>Bewirbst du ein VSL Video? </h2>
          <div class="wizard-options">
            <label class="wizard-option">
              <input type="radio" name="has-vsl" value="yes" />
              <div class="option-card">
                <div class="option-icon">üé•</div>
                <div class="option-title">Ja</div>
                <div class="option-desc">Ich bewerbe ein VSL Video</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="has-vsl" value="no" />
              <div class="option-card">
                <div class="option-icon">‚ùå</div>
                <div class="option-title">Nein</div>
                <div class="option-desc">Es gibt kein Video</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Step 2B: No VSL ‚Üí Next Step -->
        <div class="wizard-step" data-step="2b">
          <h2>Was ist der n√§chste Schritt auf der Landingpage?</h2>
          <div class="wizard-options">
            <label class="wizard-option">
              <input type="radio" name="no-vsl-next" value="survey" />
              <div class="option-card">
                <div class="option-icon">üìã</div>
                <div class="option-title">Fragebogen ausf√ºllen</div>
                <div class="option-desc">Prospect beantwortet Fragen</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="no-vsl-next" value="booking" />
              <div class="option-card">
                <div class="option-icon">üìÖ</div>
                <div class="option-title">Gespr√§ch direkt buchen</div>
                <div class="option-desc">Kein Fragebogen, direkt zum Booking</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Step 3: Opt-in?   -->
        <div class="wizard-step" data-step="3">
          <h2>Gibt es auf der Landingpage ein Opt-in?</h2>
          <div class="wizard-options">
            <label class="wizard-option">
              <input type="radio" name="optin" value="yes" />
              <div class="option-card">
                <div class="option-icon">üìß</div>
                <div class="option-title">Ja, es gibt einen Opt-in</div>
                <div class="option-desc">Das Video wird erst nach dem Opt-in freigeschalten</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="optin" value="no" />
              <div class="option-card">
                <div class="option-icon">‚ñ∂Ô∏è</div>
                <div class="option-title">Nein, es geht direkt zum VSL</div>
                <div class="option-desc">Kein Opt-in, das Video ist direkt auf der Landingpage zu sehen</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Step 3B: After VSL -->
        <div class="wizard-step" data-step="3b">
          <h2 id="afterVslQuestion">Was passiert, nachdem dein Prospect das Video gesehen hat?</h2>
          <div class="wizard-options">
            <label class="wizard-option">
              <input type="radio" name="after-vsl" value="survey" />
              <div class="option-card">
                <div class="option-icon">üìã</div>
                <div class="option-title">Er f√ºllt einen Fragebogen aus</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="after-vsl" value="booking" />
              <div class="option-card">
                <div class="option-icon">üìÖ</div>
                <div class="option-title">Er bucht sich gleich sein Erstgespr√§ch</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Step 4: Survey Qualification -->
        <div class="wizard-step" data-step="4">
          <h2>Werden Prospects im Fragebogen aussortiert?</h2>
          <div class="wizard-options">
            <label class="wizard-option">
              <input type="radio" name="survey-quali" value="yes" />
              <div class="option-card">
                <div class="option-icon">‚úÖ</div>
                <div class="option-title">Ja</div>
                <div class="option-desc">Nur qualifizierte Leads k√∂nnen einen Call buchen</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="survey-quali" value="no" />
              <div class="option-card">
                <div class="option-icon">‚û°Ô∏è</div>
                <div class="option-title">Nein</div>
                <div class="option-desc">Jeder kann einen Call buchen</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Step 5: Call Booking -->
        <div class="wizard-step" data-step="5">
          <h2>Welcher Call wird zuerst gebucht?</h2>
          <div class="wizard-options">
            <label class="wizard-option">
              <input type="radio" name="close-type" value="1-call" />
              <div class="option-card">
                <div class="option-icon">1Ô∏è‚É£</div>
                <div class="option-title">Nur Closing Call</div>
                <div class="option-desc">1-Call Close</div>
              </div>
            </label>
            <label class="wizard-option">
              <input type="radio" name="close-type" value="2-call" />
              <div class="option-card">
                <div class="option-icon">2Ô∏è‚É£</div>
                <div class="option-title">Erst Setting Call ‚Üí dann Closing Call</div>
                <div class="option-desc">2-Call Close</div>
              </div>
            </label>
          </div>
          <p class="wizard-hint">üí° <strong>Tipp:</strong> Wenn dein Prospect einen Closing Call bucht (auch wenn du ihn
            vor dem Termin anrufst, um zu setten), w√§hle <strong>1-Call Close</strong>. Es wird kein Setting Call aktiv
            gebucht.</p>
        </div>

        <!-- Step 6: Name & Color -->
        <div class="wizard-step" data-step="6">
          <h2>Fast fertig! Gib deinem Funnel einen Namen. </h2>
          <label style="display: block; margin-bottom: 16px;">
            Name:
            <input type="text" id="wizardFunnelName" placeholder="z.B. Facebook Ads VSL"
              style="width: 100%; margin-top: 8px; padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 6px;" />
          </label>
          <label style="display: block; margin-top: 16px;">
            Farbe:
          </label>
          <div class="color-picker" id="wizardColorPicker">
            <div class="color-option" data-color="#1877f2" style="background: #1877f2;"></div>
            <div class="color-option" data-color="#ff0000" style="background: #ff0000;"></div>
            <div class="color-option" data-color="#00d26a" style="background: #00d26a;"></div>
            <div class="color-option" data-color="#ff6b00" style="background: #ff6b00;"></div>
            <div class="color-option active" data-color="#9146ff" style="background: #9146ff;"></div>
            <div class="color-option" data-color="#0088cc" style="background: #0088cc;"></div>
            <div class="color-option" data-color="#25d366" style="background: #25d366;"></div>
            <div class="color-option" data-color="#333333" style="background: #333333;"></div>
          </div>
        </div>

        <!-- Step 7: Summary -->
        <div class="wizard-step" data-step="7">
          <h2>‚úÖ Dein Funnel ist bereit!</h2>
          <div class="wizard-summary">
            <h3 id="summaryFunnelName">Facebook Ads VSL</h3>
            <div class="summary-item">
              <span class="summary-label">üîπ Traffic:</span>
              <span id="summaryTraffic">Paid Ads</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">üîπ Funnel:</span>
              <span id="summaryFunnel">Classic VSL</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">üîπ Qualifikation:</span>
              <span id="summaryQuali">Qualified Survey</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">üîπ Close:</span>
              <span id="summaryClose">1-Call Close</span>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <div class="wizard-nav">
          <div class="wizard-nav-left">
            <button id="wizardBack" class="wizard-btn-secondary" style="display: none;">‚Üê Zur√ºck</button>
          </div>
          <div class="wizard-nav-right">
            <button id="wizardNext" class="wizard-btn-primary" disabled>Weiter ‚Üí</button>
            <button id="wizardCreate" class="wizard-btn-primary" style="display: none;">Funnel erstellen ‚úì</button>
            <button id="wizardCancel" class="wizard-btn-cancel">Abbrechen</button>
          </div>
        </div>

      </div>

      <!-- PRESET MODE (alter Code bleibt!) -->
      <div id="presetMode" class="preset-container hidden">
        <h2>Neuen Funnel erstellen</h2>
        <form id="funnelForm">
          <label>
            Name:
            <input type="text" id="funnelNameInput" placeholder="z.B.  TikTok Ads VSL" required />
          </label>

          <!-- Template & Traffic Row -->
          <div class="template-row">
            <label style="display: block; margin-bottom: 16px;">
              Template:
              <select id="templateSelect"
                style="width: 100%; margin-top: 8px; padding: 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px;">
                <!-- wird dynamisch bef√ºllt -->
              </select>
            </label>

            <label style="display: block; margin-bottom: 16px;">
              Traffic-Quelle:
            </label>
            <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
              <label style="display: flex; align-items: center;">
                <input type="radio" name="traffic" value="paid-ads" checked style="margin-right: 8px;" />
                Paid Ads
              </label>
              <label style="display: flex; align-items: center;">
                <input type="radio" name="traffic" value="cold-email" style="margin-right: 8px;" />
                Cold Email
              </label>
              <label style="display: flex; align-items: center;">
                <input type="radio" name="traffic" value="cold-calls" style="margin-right: 8px;" />
                Cold Calls
              </label>
              <label style="display: flex; align-items: center;">
                <input type="radio" name="traffic" value="organic" style="margin-right: 8px;" />
                Organic
              </label>
            </div>
          </div>

          <label style="margin-top: 16px; display: block;">
            Farbe:
          </label>
          <div class="color-picker">
            <div class="color-option" data-color="#1877f2" style="background: #1877f2;"></div>
            <div class="color-option" data-color="#ff0000" style="background: #ff0000;"></div>
            <div class="color-option" data-color="#00d26a" style="background: #00d26a;"></div>
            <div class="color-option" data-color="#ff6b00" style="background: #ff6b00;"></div>
            <div class="color-option active" data-color="#9146ff" style="background: #9146ff;"></div>
            <div class="color-option" data-color="#0088cc" style="background: #0088cc;"></div>
            <div class="color-option" data-color="#25d366" style="background: #25d366;"></div>
            <div class="color-option" data-color="#333333" style="background: #333333;"></div>
          </div>

          <div class="buttons">
            <button type="button" id="cancelFunnelModal">Abbrechen</button>
            <button type="submit" id="createFunnel">Erstellen</button>
          </div>
        </form>
      </div>

    </div>
  </div>
  </div>

  <!-- Modal: Funnel umbenennen -->
  <div id="renameFunnelModal" class="modal hidden">
    <div class="modal-content">
      <h2>Funnel umbenennen</h2>
      <form id="renameForm">
        <label>
          Neuer Name:
          <input type="text" id="renameInput" placeholder="z.B. TikTok Ads" required />
        </label>

        <div class="buttons">
          <button type="button" id="cancelRename">Abbrechen</button>
          <button type="submit" id="confirmRename">Umbenennen</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Farbe √§ndern -->
  <div id="changeColorModal" class="modal hidden">
    <div class="modal-content">
      <h2>Farbe √§ndern</h2>
      <form id="colorForm">
        <label style="margin-top: 16px; display: block;">
          Neue Farbe:
        </label>
        <div class="color-picker" id="colorPickerEdit">
          <div class="color-option" data-color="#1877f2" style="background: #1877f2;"></div>
          <div class="color-option" data-color="#ff0000" style="background: #ff0000;"></div>
          <div class="color-option" data-color="#00d26a" style="background: #00d26a;"></div>
          <div class="color-option" data-color="#ff6b00" style="background: #ff6b00;"></div>
          <div class="color-option" data-color="#9146ff" style="background: #9146ff;"></div>
          <div class="color-option" data-color="#0088cc" style="background: #0088cc;"></div>
          <div class="color-option" data-color="#25d366" style="background: #25d366;"></div>
          <div class="color-option" data-color="#333333" style="background: #333333;"></div>
        </div>

        <div class="buttons">
          <button type="button" id="cancelColor">Abbrechen</button>
          <button type="submit" id="confirmColor">Farbe √§ndern</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Funnel l√∂schen (Best√§tigung) -->
  <div id="deleteFunnelModal" class="modal hidden">
    <div class="modal-content delete-modal">
      <h2>‚ö†Ô∏è Funnel l√∂schen? </h2>
      <p id="deleteFunnelText">M√∂chtest du wirklich "<strong id="deleteFunnelName"></strong>" l√∂schen?</p>
      <p class="warning-text">‚ö†Ô∏è Alle Monate und Daten dieses Funnels werden unwiderruflich gel√∂scht! </p>

      <div class="buttons">
        <button type="button" id="cancelDeleteFunnel" class="btn-secondary">Abbrechen</button>
        <button type="button" id="confirmDeleteFunnel" class="btn-danger">L√∂schen</button>
      </div>
    </div>
  </div>

  <!-- Modal: CSV-Import -->
  <div id="importModal" class="modal hidden">
    <div class="modal-content import-modal">

      <!-- Step 1: Datei + Monat w√§hlen -->
      <div id="importStep1" class="import-step">
        <h2>üì§ Daten importieren</h2>

        <p style="margin-bottom: 16px;">
          <strong>Funnel:</strong> <span id="importFunnelName" style="color: #1877f2;"></span>
        </p>

        <!-- üî• CSV ZUERST -->
        <label style="display: block; margin-bottom: 16px;">
          üìÅ CSV-Datei:
          <button type="button" id="selectCsvBtn" class="btn-secondary" style="margin-top: 8px; width: 100%;">
            Datei ausw√§hlen
          </button>
          <span id="selectedFileName"
            style="display: block; margin-top: 8px; font-size: 13px; color: #666; font-style: italic;"></span>
        </label>

        <!-- üî• MONAT DANACH (initial versteckt) -->
        <div id="monthSelectWrapper" style="display: none; margin-bottom: 16px;">
          <label style="display: block;">
            üìÖ Monat ausw√§hlen:
            <select id="importMonthSelect" style="width: 100%; margin-top: 8px;">
              <!-- wird dynamisch bef√ºllt -->
            </select>
          </label>
          <p id="monthHint" style="font-size: 13px; color: #666; margin-top: 8px; font-style: italic;">
            <!-- "November 2025 wurde automatisch erkannt" -->
          </p>
        </div>

        <div class="buttons" style="margin-top: 24px; justify-content: flex-end;">
          <button type="button" id="nextToMapping" class="btn-primary" disabled>Weiter</button>
        </div>
      </div>

      <!-- Step 2: Spalten-Mapping -->
      <div id="importStep2" class="import-step hidden">
        <h2>üìä Spalten zuordnen</h2>
        <p style="font-size: 14px; color: #666; margin-bottom: 16px;">
          Ordne die CSV-Spalten den Clarity-Feldern zu:
        </p>

        <div id="columnMappingList" class="column-mapping-list">
          <!-- wird dynamisch bef√ºllt -->
        </div>

        <div class="buttons" style="margin-top: 24px; justify-content: flex-end;">
          <button type="button" id="proceedToImport" class="btn-primary">Weiter</button>
        </div>
      </div>

      <!-- Step 3: Duplikat-Warnung -->
      <div id="importStep3" class="import-step hidden">
        <h2 id="conflictWarningTitle" style="display: none;">‚ö†Ô∏è Monat enth√§lt bereits Daten</h2>
        <p id="conflictWarningText" style="font-size: 14px; margin-bottom: 16px; display: none;">
          <strong id="conflictMonthName"></strong> enth√§lt bereits Daten.
        </p>

        <label style="display: flex; align-items: flex-start; margin-bottom: 12px; cursor: not-allowed; opacity: 0.5;">
          <input type="radio" name="conflictMode" value="merge" checked disabled
            style="margin-right: 8px; margin-top: 3px;" />
          <div>
            <strong>Daten zusammenf√ºhren (Merge)</strong><br />
            <span style="font-size: 13px; color: #666;">Leere Felder werden bef√ºllt, bestehende Werte bleiben
              erhalten</span>
          </div>
        </label>

        <label style="display: flex; align-items: flex-start; margin-bottom: 16px; cursor: not-allowed; opacity: 0.5;">
          <input type="radio" name="conflictMode" value="overwrite" disabled
            style="margin-right: 8px; margin-top: 3px;" />
          <div>
            <strong>Daten √ºberschreiben</strong><br />
            <span style="font-size: 13px; color: #666;">Alle bestehenden Daten werden gel√∂scht und ersetzt</span>
          </div>
        </label>

        <div class="buttons" style="margin-top: 24px; justify-content: flex-end; gap: 12px;">
          <button type="button" id="cancelImportStep3" class="btn-secondary"
            onclick="window.closeImportModalFromButton()">Abbrechen</button>
          <button type="button" id="confirmImport" class="btn-primary">Importieren</button>
        </div>
      </div>

      <!-- Step 4: Erfolg -->
      <div id="importStep4" class="import-step hidden">
        <h2>‚úÖ Import abgeschlossen! </h2>
        <div id="importSummary"
          style="font-size: 14px; margin: 16px 0; padding: 16px; background: #f0f8f4; border-left: 4px solid #4caf50; border-radius: 6px;">
          <!-- wird dynamisch bef√ºllt -->
        </div>

        <div class="buttons" style="margin-top: 24px; justify-content: flex-end;">
          <button type="button" id="closeImportModal" class="btn-primary"
            onclick="window.closeImportModalFromButton()">Schlie√üen</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Scripts (‚ö†Ô∏è Reihenfolge wichtig!) -->
  <script src="scripts/toast.js"></script>
  <script src="scripts/loading.js"></script>
  <!-- <script src="scripts/clipboard.js"></script> DEAKTIVIERT: Wird durch cell-selection.js ersetzt -->
  <script src="scripts/config.js"></script>
  <script src="scripts/utils.js"></script>
  <script src="scripts/cell-selection.js"></script>
  <script src="scripts/storage.js"></script>
  <script src="scripts/funnels.js"></script>
  <script src="scripts/modules.js"></script>
  <script src="scripts/month.js"></script>
  <script src="scripts/year.js"></script>
  <script src="scripts/main.js"></script>
  <script src="scripts/import.js"></script>
  <script src="scripts/wizard.js"></script>

  <!-- Versteckter File-Input -->
  <input type="file" id="csvFileInput" accept=".csv" style="display: none;" />

</body>

</html>